services:
  - docker
install:
  - docker build --build-arg BUILDKIT_INLINE_CACHE=1 --cache-from j0elwee/devops-trg -t j0elwee/devops-trg -t j0elwee/devops-trg:$TRAVIS_COMMIT --target production .
  - docker build --build-arg BUILDKIT_INLINE_CACHE=1 --cache-from j0elwee/devops-trg:ci -t j0elwee/devops-trg:ci --target ci .
script:
  - docker run -e TRELLO_API_KEY -e TRELLO_API_TOKEN j0elwee/devops-trg:ci
after_success:
  - echo $DOCKER_HUB_PASSWORD | docker login -u j0elwee --password-stdin
  - docker push j0elwee/devops-trg
  - docker push j0elwee/devops-trg:$TRAVIS_COMMIT
  - docker push j0elwee/devops-trg:ci
before_deploy:
  - wget -qO- https://toolbelt.heroku.com/install.sh | sh
  - docker login -u "joel.wee@softwire.com" --password=$HEROKU_API_KEY registry.heroku.com
  - docker tag j0elwee/devops-trg registry.heroku.com/devops-trg/web
  - docker push registry.heroku.com/devops-trg/web
deploy:
  provider: script
  script: heroku container:release web -a devops-trg
env:
  global:
  - secure: diiXAudwQgTtKwjS/VESa5ixxtTxDte95Ox8x1I63s6aZifqCluQJNxWu0jUNE88JmO6WfLFITb36krW81f85CEfXFnqSJuhU9Bx4l5W+oIYiIDHBhlaPj8+vZy5nPBE54wHgjPIZJXu3hGkEMcrnvGCLZGNvEd6PoSvwOoRwvrNp5e2LC8dnM8+kCPnlDVwwppRj5w/ysIDsCZqlbCI67jR2Fd91gKJhREWtopzkaKnDahjo4kRUqu25I3SaI6QUBTAaKzTGxUsNrrrWXFXLkSVSL7amZA+xoyOCE2m9MD/Ffx93R+Y6OT43glvab4s7wVtyqwyMzpcvnhZR6mEXeJGHJDeJKLQap7RaHqWUfpz0dwfnv0bJ8eByl34n8GZE/nD8akohD6IQKQaHezgCkxKwdM/wveNpzmUlfHGGAcguG8XjqgKsQUFhoGlDbnfesQVefyXLfc91hLTfIVNUsUFYVA28Sk8dqp/ph6ukA+JemHOSxrromeebwMoy20tG4c9lEzQPXsjsURdIB4mXYgU0iNKr0MVxX8edOG8QqBe4un7qzMz/SHzkyr2QXJiVjVIMVytuPTAWpPqOM/KtxTIIL+z3U7RGIqm1aEgn3wPJdIMB4l0I2Qs6kD280kNThHfollyXbcT1qcJEnfc3KkeoCHmp3qTNalQDT140dA=
  - secure: auoWRMnfrRExsTTVPw/kbkdGGqoodFjPyyXqGi43XdDlY71NBNokfG3Yaqry9hfqBJIZ1mEh2lijLHozW0vsmeEM5qb0UGiL93e9eBfdDORO/BRLKeOqqcir3RlHe5EJSipz6iOMj948xlchpm3WvLczr5Zv+fKWgs3N1kBDqPsBxVPQuBJFGDlVN/IhvPO6AKC+1LBMXhf4OkK6VimLSq9Vg5JIKlng8RA2fsGGrpJM4lLLVODU1JqWJsCk5QuuL95Bar4mx88kRUOQpMsHmLDFP0GkcRs/9w+pA0Z5f5j36CtpJeqgmNIcgPnzbSb/zfNZKUQSC+cdfPRPHo4XILhaYkhUPblLWY/zghaYAoP1UPX+n1/AtPMtR0v9sCngU5le4kDSZa4iWiA27UpmqE1EsU+Zx+QzfhiQs1fM0yctv0o0+YFZdrNdWFXQ1ZgoiY7VHgZ+fqnlKq5bPVZTYR77cCcgKhp0vAuEM9rp2zVH+ffZ+S9BKQSW/YkWxlj4M+HAxN164NSSFH/QJHFz3lHLRrJ5er43RqA7eiOkwT2bhEpTQ+MfwyWJf36Q2aCEAx6Hmv/x2aRs7Jr7NaAM5fx4bvzwq+24I4uc/+x913X9T2g4pFgpJqsL/lMkvVYyKe//g2K9CviaTgt3TdE+3iEk6v1DG18iYbaUKNtIcy8=
  - secure: IE3AY/wWEbxYRnTUH2lfGlzXtKaSnIJk/x22Sk6ONikIQXiaYXbqnFfzQ6Dlg9GBkq5zzfkJag5yIL5wAhNfI5EkWDi4B9ki2PakL00r9o8wzdgd/9pySf9cUWB0ldA+iroJ82Jux5ql+LoGpe3xEg9vt/+AzO8Rtn9wWnnUm/DIsMeAT695ufcG55+cLfeukZh19BAGqibv0wyQDzEDTZ+fIheV/Rn2Vl+spX+CAC1au1eZ4AA+BjxV/VxXUtM/yQ5PGwR4yOKn30ODrRNOBcM+i7+LH1VTsuYXeqNR55iDyRw5+X9Qgl7ZFdhYCaBo0nnnfaOcL5zTGS0/lFhfmpLvx6olcU9WGu1gumemjGqaQa1uL30UtnNwXHRZWunvd1Zlu0SertNqt8zsN0ibfSmO7NRozMcZGGOJQ9oDzTCbZKvL+Nozm8cc1c/uy61SN+2t1ssbyly8seggmbxbH+nq/Gxk3d8vSYscpBj144Znf/u75eZrF2gVazeOfm4VOZX0LyC9Tn1P93oEh9mWEXj6bpcpjUoDZ7gt10EIDE9m1Jlh0NyqRW3CxTDfDDRpEVd9Uz48dSzcUFdrda1eZSVtIOkUSUZIgIiVCrtrLY+q+rhaawPU3wqOICYyru8eksV0NtRSOklmpNBrsbjUVPzvUlRNLbacNPFwlyZOe+k=
  - secure: fBo0RGHRlrTfBvNzYHY20212Ygcvs+kUjKJGKn6/80PY2+Ix8o738Bil8i/loul6h9wbSHQXwYX75xuqToTHgf/7ZiAu6cgVsZKvemmzF0hwakuF8RRyNlhetSXhiHhKWBsi+rAfswU0g1rb17Nyf78uUp1rrtzgFNTgVkgfT/uEUzqnqhWNfUP4KNuQSM6XOjE+j/YhTBAEEXLIPrIjNUJqz4RS4dz/yogJp8qe/3cF9hwEdeeLlE4hCIEGDZyfURgfHiMcAQq4TvT64GyLWm7WHaoB4xz0VqenWfz+9nCSg6bHNXQcTxUHiHaqHQqF/TqEd8dOPz2zAmNLej5jnRrB4ptSpCEriyAyPtD0A7/sB7FF+Cpsd6IiG4nu+seHTABFnP9yo9/sS4m2ezNzsoTvldqnceeieCWGp7ifIbcyj/Rpm8SJ4iusmofGdC9PKpRsHj4ZSiWIDHknNEWjCAV2KtRuB2ZVLmH5GJlg9eOkZBuuld0Ux6f4E4ON1QeeQV0IuKypAqV92AyJ3F6oFehXyq6GlKRG2w3c0uWGj7FtOBkcQ0DaMWbYDeyBjPSPRCfrOIkcnUyK7/Nl+1wVADJYwPdmSCUR3KToDuwHctBA80puc2TOv/Mhy144l1xc1Qz5xYfbbrBgoie0UzoQZEjEA6xFBeQOLanlcCC4500=
  - secure: UwMUyLZN1g+zqo+7+xIftHXzpWSKUWhS2DZHQSMdPURlD/n9GMZvuJXJ7mzh1MV1KJi+acIPE7Ho3pLVdu1zTkJ47oN8dsnLzXih6yaqD768b51/u0v/G49+9nsjUBkQ5ds7ZvC9OyW1uYKU1aUfjL9X3ejcbmUbfXTMLGPFPbRS/4S3a9HmgzYjFCPPEMZvwppufojhZ72HirjYISRk0KjB+KWcmqShpsZvef+H4VEdGTsdiWjhq3SaTU1R7FF5kcg4j3hN5guZFwIYfJMVG8RouCvzGU2voAbBNImu5Dugwna0cZJPZVJvz88vTimMKal8E22EC3aNaduB9pNcF9lWYmSwL/aoXCGfXke9swXRtSV4Ma+cpZYFb+ju/Af2WoOybs9ygTH5L5aV7wg3P5XuB1AkCPbr1uQsmQbENvDqJNU8hhDmezYXhr4jLOtZ8DF37jtMDhUAeFhQpKZMcxaay5cvaupEUILI1QaFWSmcYgXWz0yonR0gooXZHfZYJZZ98nFqOGGsLgrz/M0DVN6EBBRqNXjKW8RtTzHXRDe2EuPu2r7UrLbE1upTAHwc9xtAWxVorTxkpZvFA9bml0HGjS8ak2yRfVxrDC/Xm5wGPsNBLkRh73h2H5UjOjEyRiumPOKM/JrEwysd/J3sxZuqeQ1uaEzdIIcYuQTSNVw=
  - secure: s0iHDCGnS/PtBxHi/s/+5rEho2ZhMs+KpV6zMEqSNBxFS58+1zq0xX7GHeOyEAfTouTFnHyy1edAqVfLdNozLYqf7XjIZUztmMEtrcKJcndH9YBDwLOFA0CfA5HEG9AoKcskIXT0eEvf9oZ8E1viWvrjvXiBu8FkvwXsEbzIY1GoImiMpHQGoQ/PdRTEhb7XIV06zZaltF3B2/r9boqAqQEsieXYgr3uJXssjdnh7eolsC7lTuMcK/O2KGWYmM4Tlfw5xD9D8Uvxr52OLwfIvitLAHjG59et2zeM4oTy2nAQso8PwzUFoC65C9g9lEWD2k7EadrrukKJrJjmylmWFrYTjSxPdsk2ye0Uv07Rtv/aYv5Vnqf5c0HF5K+w7feWXbK5Mw7lSbRY9gzAThTyNe4prjfDJcqIV5bQXXv8E8IvA3KjNqWdMNTE33832a/Uaev+uYqjgSPFl9xd6S34KxOQJG1kNNVl9eZDi9Pxi3WYYJZIS2cosidgFQTNxzQuPTU+yj7agnbhDw5taB6lDUo3NWJconerLyr9R0TOwb+dvxb2vOGlYqLqnYDkbmQgzLmqiZAEb/yDbSb689y9G4YeU7T9pAvbZHiKdhN5S9gt2IU++ARpri4m5uYljp7pSZawKPgX+e5/Tc6SrLW9BYfexYIQnmR2UFvSXBDUdy0=
